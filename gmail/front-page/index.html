<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>R√©cap e-mails du jour</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/style/style.css?v=1759265587" />
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <!-- Loading overlay -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="spinner"></div>
    <p>Chargement en cours...</p>
  </div>

  <header class="topbar">
    <a href="/" class="logo" title="Recharger la page" aria-label="Retour √† l'accueil">
      <svg class="logo-icon" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
        <!-- Enveloppe moderne et douce -->
        <!-- Base de l'enveloppe -->
        <rect x="8" y="14" width="32" height="22" rx="3" fill="url(#envelopeGradient)"/>
        <!-- Rabat sup√©rieur ferm√© -->
        <path d="M 8 14 L 24 26 L 40 14 Z" fill="url(#flapGradient)" opacity="0.9"/>
        <!-- Ligne de pli -->
        <path d="M 8 14 L 24 26 L 40 14" stroke="white" stroke-width="1" opacity="0.3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
        <!-- Point d√©coratif (timbre) -->
        <circle cx="35" cy="20" r="2.5" fill="white" opacity="0.4"/>
        <defs>
          <linearGradient id="envelopeGradient" x1="8" y1="14" x2="40" y2="36" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#eff6ff"/>
            <stop offset="50%" stop-color="#dbeafe"/>
            <stop offset="100%" stop-color="#bfdbfe"/>
          </linearGradient>
          <linearGradient id="flapGradient" x1="24" y1="14" x2="24" y2="26" gradientUnits="userSpaceOnUse">
            <stop offset="0%" stop-color="#bfdbfe"/>
            <stop offset="100%" stop-color="#93c5fd"/>
          </linearGradient>
        </defs>
      </svg>
      <h1 class="logo-text">maily</h1>
    </a>
  </header>

  <main class="layout">
    <!-- R√©sum√© optimis√© -->
    <aside class="card summary" role="complementary" aria-label="R√©sum√© du jour">
      <div class="summary-header">
        <h2>R√©sum√©</h2>
        <span id="urgencyBadge" class="urgency-badge-inline hidden">
          <span id="urgencyText" class="urgency-text">‚Äî</span>
        </span>
      </div>

      <div id="summaryBody" class="summary-body">
        <!-- M√©triques + Urgence -->
        <div class="metric-cards">
          <div class="metric-card">
            <i data-lucide="calendar" class="metric-icon"></i>
            <div class="metric-content">
              <span class="metric-label">Date</span>
              <strong id="sumDay" class="metric-value">‚Äî</strong>
            </div>
          </div>
          <div class="metric-card">
            <i data-lucide="mail" class="metric-icon"></i>
            <div class="metric-content">
              <span class="metric-label">Total</span>
              <strong id="sumTotal" class="metric-value">‚Äî</strong>
            </div>
          </div>
        </div>
        
        <!-- R√©sum√© AI g√©n√©r√© -->
        <div class="ai-summary">
          <div class="ai-header">
            <i data-lucide="sparkles" class="ai-icon"></i>
            <span class="ai-title">R√©sum√© IA</span>
          </div>
          <p id="sumTLDR" class="ai-content">‚Äî</p>
        </div>

        <!-- Emails prioritaires -->
        <div id="prioritySection" class="summary-section hidden">
          <div class="summary-section-header">
            <i data-lucide="star" class="summary-icon"></i>
            <span class="summary-section-title">√Ä traiter en priorit√©</span>
          </div>
          <div id="sumPriority" class="priority-list">‚Äî</div>
        </div>
        
        <!-- Th√®mes cl√©s -->
        <div id="topicsSection" class="summary-section hidden">
          <div class="summary-section-header">
            <i data-lucide="tag" class="summary-icon"></i>
            <span class="summary-section-title">Th√®mes cl√©s</span>
          </div>
          <div id="sumTopics" class="topics-inline">‚Äî</div>
        </div>
      </div>
      
      <div class="summary-actions">
        <button id="refreshBtn" class="btn primary large" aria-label="Actualiser les e-mails">
          <i data-lucide="refresh-cw" style="width:16px;height:16px"></i>
          <span class="btn-text">Actualiser</span>
        </button>
        <span id="lastUpdated" class="last-updated" role="status" aria-live="polite">‚Äî</span>
      </div>
    </aside>

    <!-- Liste des mails optimis√©e -->
    <section class="card list" role="main" aria-label="Liste des e-mails">
      <!-- Toolbar des filtres unifi√©e -->
      <div class="filters-toolbar">
        <!-- Recherche (pleine largeur) -->
        <div class="search-container">
          <i data-lucide="search" class="search-icon"></i>
          <input 
            id="searchInput" 
            type="search" 
            placeholder="Rechercher dans les emails..." 
            class="search-input"
            aria-label="Rechercher dans les e-mails"
            autocomplete="off"
          />
          <kbd class="search-shortcut" aria-hidden="true">/</kbd>
        </div>

        <!-- Filtres (ligne en dessous) -->
        <div class="filters-row">
          <!-- Filtre exp√©diteur -->
          <div class="filter-item">
            <button id="senderFilterBtn" class="filter-btn" aria-haspopup="listbox" aria-expanded="false">
              <i data-lucide="user" class="filter-icon"></i>
              <span id="senderFilterLabel" class="filter-label">Exp√©diteur</span>
              <i data-lucide="chevron-down" class="filter-chevron"></i>
            </button>
            <div id="senderDropdown" class="filter-dropdown-menu hidden">
              <div class="dropdown-search">
                <i data-lucide="search" class="dropdown-search-icon"></i>
                <input 
                  id="senderSearchInput" 
                  type="search" 
                  placeholder="Rechercher un exp√©diteur..."
                  class="dropdown-search-input"
                />
              </div>
              <div id="senderList" class="dropdown-list">
                <!-- Options remplies dynamiquement -->
              </div>
            </div>
          </div>

          <!-- Tri -->
          <div class="filter-item">
            <button id="sortBtn" class="filter-btn" aria-haspopup="listbox" aria-expanded="false">
              <i data-lucide="arrow-down-up" class="filter-icon"></i>
              <span id="sortLabel" class="filter-label">Tri</span>
              <i data-lucide="chevron-down" class="filter-chevron"></i>
            </button>
            <div id="sortDropdown" class="filter-dropdown-menu hidden">
              <div class="dropdown-list">
                <button class="dropdown-item" data-sort="custom" data-sort-label="Personnalis√©">
                  <i data-lucide="grip-vertical" class="dropdown-icon"></i>
                  <span>Ordre personnalis√©</span>
                </button>
                <button class="dropdown-item" data-sort="dateDesc" data-sort-label="R√©cents d'abord">
                  <i data-lucide="arrow-down" class="dropdown-icon"></i>
                  <span>Plus r√©cents</span>
                </button>
                <button class="dropdown-item" data-sort="dateAsc" data-sort-label="Anciens d'abord">
                  <i data-lucide="arrow-up" class="dropdown-icon"></i>
                  <span>Plus anciens</span>
                </button>
                <button class="dropdown-item" data-sort="senderAsc" data-sort-label="A ‚Üí Z">
                  <i data-lucide="arrow-up-a-z" class="dropdown-icon"></i>
                  <span>A ‚Üí Z</span>
                </button>
                <button class="dropdown-item" data-sort="senderDesc" data-sort-label="Z ‚Üí A">
                  <i data-lucide="arrow-down-z-a" class="dropdown-icon"></i>
                  <span>Z ‚Üí A</span>
                </button>
              </div>
            </div>
          </div>

          <!-- S√©parateur visuel -->
          <div class="filter-separator"></div>

          <!-- Toggle √©pingl√©s (plus important ‚Üí en premier) -->
          <button id="togglePinned" class="filter-toggle" data-pinned-only="false" aria-pressed="false" title="Filtrer uniquement les emails √©pingl√©s">
            <i data-lucide="pin" class="filter-icon"></i>
            <span id="togglePinnedLabel" class="filter-label">Tous</span>
            <span class="filter-badge" id="countPinned">0</span>
          </button>

          <!-- Toggle affichage -->
          <button id="toggleShowDone" class="filter-toggle" data-show-done="true" aria-pressed="true" title="Afficher tous les emails ou masquer les archiv√©s">
            <i data-lucide="eye" class="filter-icon"></i>
            <span id="toggleShowLabel" class="filter-label">Complet</span>
          </button>

          <!-- Toggle corbeille (en dernier) -->
          <button id="toggleTrash" class="filter-toggle" data-trash-only="false" aria-pressed="false" title="Afficher uniquement les emails supprim√©s">
            <i data-lucide="inbox" class="filter-icon"></i>
            <span id="toggleTrashLabel" class="filter-label">Bo√Æte</span>
            <span class="filter-badge" id="countTrash">0</span>
          </button>
        </div>
      </div>

      <!-- üìã LISTE DES EMAILS -->
      <div class="table-wrap" role="region" aria-label="Tableau des e-mails" tabindex="0">
        <table class="mails">
          <thead>
            <tr>
              <th class="th-grab" scope="col"></th>
              <th class="th-sender" scope="col">Exp√©diteur</th>
              <th class="th-subject" scope="col">Objet</th>
              <th class="th-time" scope="col">Heure</th>
              <th class="th-pinned" scope="col"></th>
              <th class="th-status" scope="col"></th>
              <th class="th-trash" scope="col"></th>
            </tr>
          </thead>
          <tbody id="mailsTbody">
            <!-- Rempli dynamiquement : show en haut, hide check√©s en bas -->
          </tbody>
        </table>
      </div>

      <!-- √âtat vide -->
      <div id="emptyState" class="empty-state hidden" role="status">
        <div class="empty-emoji">üì≠</div>
        <h3 id="emptyTitle" class="empty-title">Aucun e-mail trouv√©</h3>
        <p id="emptyDescription" class="empty-description">Essayez de modifier vos filtres de recherche</p>
      </div>
    </section>
  </main>

  <!-- Toast am√©lior√© -->
  <div id="toast" class="toast hidden" role="alert" aria-live="assertive" aria-atomic="true"></div>

  <!-- Modal d√©tail email -->
  <div id="emailModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <button id="modalPrev" class="modal-nav" aria-label="Email pr√©c√©dent" title="Pr√©c√©dent">
          <i data-lucide="chevron-left"></i>
        </button>
        <h2 id="modalTitle" class="modal-title">D√©tail de l'email</h2>
        <button id="modalNext" class="modal-nav" aria-label="Email suivant" title="Suivant">
          <i data-lucide="chevron-right"></i>
        </button>
        <button id="modalClose" class="modal-close" aria-label="Fermer">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <!-- Sujet principal -->
        <h3 id="modalSubject" class="modal-subject">‚Äî</h3>
        
        <!-- M√©ta minimale -->
        <div class="modal-meta">
          <span id="modalFrom" class="modal-from">‚Äî</span>
          <span class="modal-dot">‚Ä¢</span>
          <span id="modalDate" class="modal-date">‚Äî</span>
        </div>
      </div>
      <div class="modal-footer">
        <div class="modal-actions-left">
          <button id="modalPin" class="btn-modal-action" title="√âpingler">
            <i data-lucide="pin" class="action-icon"></i>
          </button>
          <button id="modalHide" class="btn-modal-action" title="Archiver">
            <i data-lucide="eye" class="action-icon"></i>
          </button>
          <button id="modalTrash" class="btn-modal-action" title="Supprimer">
            <i data-lucide="trash-2" class="action-icon"></i>
          </button>
        </div>
        <a id="modalOpenGmail" href="#" class="btn primary" target="_blank">
          <i data-lucide="external-link" style="width:16px;height:16px"></i>
          <span>Ouvrir dans Gmail</span>
        </a>
      </div>
    </div>
  </div>

  <!-- Config -->
  <script>
    window.APP_CONFIG = {
      // Webhook local n8n
      webhookUrl: "http://localhost:5678/webhook/refresh-mails",
      
      // Fichier JSON local
      jsonUrl: "./data/mails-today.json"
    };
  </script>
  <script src="assets/script/script.js?v=1759262375" defer></script>
  <script>
    // Initialiser Lucide apr√®s chargement du DOM
    document.addEventListener('DOMContentLoaded', () => {
      if (window.lucide) {
        lucide.createIcons();
      }
    });
  </script>

  <!-- Footer discret -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-links">
        <a href="https://mail.google.com/mail/?view=cm&fs=1&to=romeo.cavazza@gmail.com" target="_blank" rel="noopener noreferrer" class="footer-link" title="Email" aria-label="Envoyer un email √† Rom√©o Cavazza">
          <i data-lucide="mail" class="footer-icon"></i>
        </a>
        <a href="https://www.linkedin.com/in/romeo-cavazza/" target="_blank" rel="noopener noreferrer" class="footer-link" title="LinkedIn" aria-label="LinkedIn de Rom√©o Cavazza">
          <i data-lucide="linkedin" class="footer-icon"></i>
        </a>
        <a href="https://github.com/RomeoCavazza" target="_blank" rel="noopener noreferrer" class="footer-link" title="GitHub" aria-label="GitHub de Rom√©o Cavazza">
          <i data-lucide="github" class="footer-icon"></i>
        </a>
      </div>
      <p class="footer-credit">Fait par Rom√©o Cavazza</p>
    </div>
  </footer>
</body>
</html>